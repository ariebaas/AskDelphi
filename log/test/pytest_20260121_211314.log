2026-01-21 21:13:14,944 - src.api_client.auth - INFO - Cached tokens geladen uit C:\Users\arieb\AppData\Local\Temp\pytest-of-arieb\pytest-50\test_token_cache_save_and_load0\tokens.json
2026-01-21 21:13:14,951 - src.api_client.auth - INFO - IDs geparst uit CMS URL
2026-01-21 21:13:14,952 - src.api_client.auth - INFO - IDs geparst uit CMS URL
2026-01-21 21:13:14,953 - src.api_client.auth - ERROR - Ontbrekende vereiste credentials: ASKDELPHI_PROJECT_ID (of ASKDELPHI_CMS_URL), ASKDELPHI_ACL_ENTRY_ID (of ASKDELPHI_CMS_URL)
2026-01-21 21:13:14,955 - src.api_client.auth - INFO - IDs geparst uit CMS URL
2026-01-21 21:13:14,956 - src.api_client.auth - INFO - ============================================================
2026-01-21 21:13:14,957 - src.api_client.auth - INFO - AUTHENTICATIE GESTART
2026-01-21 21:13:14,957 - src.api_client.auth - INFO - ============================================================
2026-01-21 21:13:14,957 - src.api_client.auth - INFO - Stap 1: Portal code uitwisselen voor tokens...
2026-01-21 21:13:14,957 - src.api_client.auth - INFO - Received access token: access_token_123...
2026-01-21 21:13:14,957 - src.api_client.auth - INFO - Received refresh token: refresh_token_456...
2026-01-21 21:13:14,957 - src.api_client.auth - INFO - Full URL from portal: https://company.askdelphi.com/project/page
2026-01-21 21:13:14,957 - src.api_client.auth - INFO - Extracted base URL: https://company.askdelphi.com
2026-01-21 21:13:14,959 - src.api_client.auth - INFO - Tokens saved to cache file
2026-01-21 21:13:14,959 - src.api_client.auth - INFO - Step 2: Getting editing API token...
2026-01-21 21:13:14,959 - src.api_client.auth - INFO -  Editing API token ontvangen: eyJ.eyJleHAiOiAxNzY5MDI5OTk0LC...
2026-01-21 21:13:14,959 - src.api_client.auth - INFO - ============================================================
2026-01-21 21:13:14,960 - src.api_client.auth - INFO - AUTHENTICATION SUCCESSFUL
2026-01-21 21:13:14,960 - src.api_client.auth - INFO - ============================================================
2026-01-21 21:13:14,962 - src.api_client.auth - INFO - IDs geparst uit CMS URL
2026-01-21 21:13:14,963 - src.api_client.auth - INFO - IDs geparst uit CMS URL
2026-01-21 21:13:14,968 - root - INFO - ============================================================
2026-01-21 21:13:14,969 - root - INFO - TESTING AUTHENTICATION AND CONNECTION:
2026-01-21 21:13:14,969 - root - INFO - ============================================================
2026-01-21 21:13:14,969 - root - INFO - Waiting for mockserver at http://127.0.0.1:8000/projects/nonexistent (timeout=10s)
2026-01-21 21:13:14,973 - root - INFO - Mockserver is reachable (status=401)
2026-01-21 21:13:14,973 - root - INFO - Resetting mockserver state...
2026-01-21 21:13:14,975 - root - INFO - Mockserver reset complete
2026-01-21 21:13:14,975 - root - INFO - Test 1: Creating AskDelphiSession with valid credentials...
2026-01-21 21:13:14,977 - root - INFO - ✓ AskDelphiSession created successfully
2026-01-21 21:13:14,977 - root - INFO - Test 2: Verifying session token retrieval via AskDelphiSession...
2026-01-21 21:13:14,981 - root - INFO - ✓ Session token obtained and used successfully (404 = project not found, auth worked)
2026-01-21 21:13:14,981 - root - INFO - Test 3: Testing invalid credentials (should fail)...
2026-01-21 21:13:14,982 - src.api_client.auth - INFO - IDs geparst uit CMS URL
2026-01-21 21:13:14,984 - root - INFO - ✓ Invalid credentials correctly rejected (status=401)
2026-01-21 21:13:14,984 - root - INFO - Test 4: Testing request without Authorization header (should fail)...
2026-01-21 21:13:14,986 - root - INFO - ✓ Request without auth header correctly rejected (status=401)
2026-01-21 21:13:14,986 - root - INFO - ============================================================
2026-01-21 21:13:14,986 - root - INFO - ALL AUTHENTICATION TESTS PASSED!
2026-01-21 21:13:14,986 - root - INFO - ============================================================
2026-01-21 21:13:14,987 - root - INFO - ============================================================
2026-01-21 21:13:14,988 - root - INFO - TESTING CONTENT EXPORT:
2026-01-21 21:13:14,988 - root - INFO - ============================================================
2026-01-21 21:13:14,988 - root - INFO - Waiting for mockserver at http://127.0.0.1:8000/projects/nonexistent (timeout=10s)
2026-01-21 21:13:14,990 - root - INFO - Mockserver is reachable (status=401)
2026-01-21 21:13:14,990 - root - INFO - Resetting mockserver state...
2026-01-21 21:13:14,992 - root - INFO - Mockserver reset complete
2026-01-21 21:13:14,992 - root - INFO - Setting up test data...
2026-01-21 21:13:14,994 - src.importer.mapper - INFO - Proces gemapt: onboard-account - Onboard nieuwe medewerker
2026-01-21 21:13:14,994 - src.importer.mapper - INFO - ✓ Proces gemapt naar 1 root topic met 2 kinderen
2026-01-21 21:13:14,995 - src.importer.importer - INFO - Import gestart van 1 root topic(s)
2026-01-21 21:13:15,000 - src.importer.importer - INFO - ✓ Topic aangemaakt: Onboard nieuwe medewerker
2026-01-21 21:13:15,003 - src.importer.importer - INFO -   ✓ Topic aangemaakt: Voorbereiding
2026-01-21 21:13:15,006 - src.importer.importer - INFO -     ✓ Topic aangemaakt: Account aanmaken
2026-01-21 21:13:15,009 - src.importer.importer - INFO -       ✓ Topic aangemaakt: Stap 1: Ga naar HR-systeem
2026-01-21 21:13:15,016 - src.importer.importer - INFO -       ✓ Topic aangemaakt: Stap 2: Vul gegevens in
2026-01-21 21:13:15,023 - src.importer.importer - INFO -     ✓ Topic aangemaakt: Werkplek voorbereiden
2026-01-21 21:13:15,026 - src.importer.importer - INFO -       ✓ Topic aangemaakt: Laptop klaarleggen
2026-01-21 21:13:15,032 - src.importer.importer - INFO -       ✓ Topic aangemaakt: Toegangspas aanmaken
2026-01-21 21:13:15,037 - src.importer.importer - INFO -   ✓ Topic aangemaakt: Eerste werkdag
2026-01-21 21:13:15,041 - src.importer.importer - INFO -     ✓ Topic aangemaakt: Welkom en rondleiding
2026-01-21 21:13:15,045 - src.importer.importer - INFO -       ✓ Topic aangemaakt: Welkom heten
2026-01-21 21:13:15,052 - src.importer.importer - INFO -       ✓ Topic aangemaakt: Rondleiding kantoor
2026-01-21 21:13:15,057 - src.importer.importer - INFO -     ✓ Topic aangemaakt: Introductie IT-systemen
2026-01-21 21:13:15,061 - src.importer.importer - INFO -       ✓ Topic aangemaakt: Email en Outlook
2026-01-21 21:13:15,066 - src.importer.importer - INFO -       ✓ Topic aangemaakt: Intranet en documenten
2026-01-21 21:13:15,068 - src.importer.importer - INFO - Import succesvol voltooid
2026-01-21 21:13:15,068 - root - INFO - ✓ Imported 1 root topics
2026-01-21 21:13:15,068 - root - INFO - Calling export endpoint...
2026-01-21 21:13:15,070 - root - INFO - ✓ Export endpoint called successfully
2026-01-21 21:13:15,070 - root - INFO - Validating export structure...
2026-01-21 21:13:15,070 - root - INFO - ✓ Export structure is valid
2026-01-21 21:13:15,071 - root - INFO - ✓ Metadata valid (exported 15 topics)
2026-01-21 21:13:15,071 - root - INFO - ✓ Content design valid (41 topic types)
2026-01-21 21:13:15,071 - root - INFO - ✓ Relations structure valid (parent=None, children=2)
2026-01-21 21:13:15,071 - root - INFO - ✓ Topics valid (15 topics exported)
2026-01-21 21:13:15,071 - root - INFO -   First topic: Onboard nieuwe medewerker
2026-01-21 21:13:15,071 - root - INFO - ============================================================
2026-01-21 21:13:15,071 - root - INFO - EXPORT TEST PASSED!
2026-01-21 21:13:15,071 - root - INFO - ============================================================
2026-01-21 21:13:15,073 - root - INFO - Waiting for mockserver at http://127.0.0.1:8000/projects/nonexistent (timeout=10s)
2026-01-21 21:13:15,074 - root - INFO - Mockserver is reachable (status=401)
2026-01-21 21:13:15,075 - root - INFO - Resetting mockserver state...
2026-01-21 21:13:15,076 - root - INFO - Mockserver reset complete
2026-01-21 21:13:15,077 - root - INFO - Loaded example JSON from C:\Users\arieb\CascadeProjects\digitalecoach_client\tests\..\procesbeschrijving\process_onboard_account.json
2026-01-21 21:13:15,077 - root - INFO - Process id=onboard-account title=Onboard nieuwe medewerker (#steps=0)
2026-01-21 21:13:15,077 - src.importer.mapper - INFO - Proces gemapt: onboard-account - Onboard nieuwe medewerker
2026-01-21 21:13:15,077 - src.importer.mapper - INFO - ✓ Proces gemapt naar 1 root topic met 2 kinderen
2026-01-21 21:13:15,078 - root - INFO - Mapped process to 1 root topic(s)
2026-01-21 21:13:15,078 - root - INFO - TOPIC TREE STRUCTURE:
[onboard-account] Onboard nieuwe medewerker (Digitale Coach Homepagina)
  ├─ [task-1] Voorbereiding (Task)
    ├─ [step-1-1] Account aanmaken (Action)
      ├─ [instr-1-1-1] Stap 1: Ga naar HR-systeem (Simple topic)
      ├─ [instr-1-1-2] Stap 2: Vul gegevens in (Simple topic)
    ├─ [step-1-2] Werkplek voorbereiden (Action)
      ├─ [instr-1-2-1] Laptop klaarleggen (Simple topic)
      ├─ [instr-1-2-2] Toegangspas aanmaken (Simple topic)
  ├─ [task-2] Eerste werkdag (Task)
    ├─ [step-2-1] Welkom en rondleiding (Action)
      ├─ [instr-2-1-1] Welkom heten (Simple topic)
      ├─ [instr-2-1-2] Rondleiding kantoor (Simple topic)
    ├─ [step-2-2] Introductie IT-systemen (Action)
      ├─ [instr-2-2-1] Email en Outlook (Simple topic)
      ├─ [instr-2-2-2] Intranet en documenten (Simple topic)
2026-01-21 21:13:15,079 - root - INFO - Created AskDelphiSession for base_url=http://127.0.0.1:8000, project_id=None
2026-01-21 21:13:15,079 - root - INFO - Starting import of topic tree into mockserver...
2026-01-21 21:13:15,079 - src.importer.importer - INFO - Import gestart van 1 root topic(s)
2026-01-21 21:13:15,085 - src.importer.importer - INFO - ✓ Topic aangemaakt: Onboard nieuwe medewerker
2026-01-21 21:13:15,087 - src.importer.importer - INFO -   ✓ Topic aangemaakt: Voorbereiding
2026-01-21 21:13:15,091 - src.importer.importer - INFO -     ✓ Topic aangemaakt: Account aanmaken
2026-01-21 21:13:15,094 - src.importer.importer - INFO -       ✓ Topic aangemaakt: Stap 1: Ga naar HR-systeem
2026-01-21 21:13:15,099 - src.importer.importer - INFO -       ✓ Topic aangemaakt: Stap 2: Vul gegevens in
2026-01-21 21:13:15,103 - src.importer.importer - INFO -     ✓ Topic aangemaakt: Werkplek voorbereiden
2026-01-21 21:13:15,106 - src.importer.importer - INFO -       ✓ Topic aangemaakt: Laptop klaarleggen
2026-01-21 21:13:15,111 - src.importer.importer - INFO -       ✓ Topic aangemaakt: Toegangspas aanmaken
2026-01-21 21:13:15,116 - src.importer.importer - INFO -   ✓ Topic aangemaakt: Eerste werkdag
2026-01-21 21:13:15,119 - src.importer.importer - INFO -     ✓ Topic aangemaakt: Welkom en rondleiding
2026-01-21 21:13:15,122 - src.importer.importer - INFO -       ✓ Topic aangemaakt: Welkom heten
2026-01-21 21:13:15,127 - src.importer.importer - INFO -       ✓ Topic aangemaakt: Rondleiding kantoor
2026-01-21 21:13:15,132 - src.importer.importer - INFO -     ✓ Topic aangemaakt: Introductie IT-systemen
2026-01-21 21:13:15,135 - src.importer.importer - INFO -       ✓ Topic aangemaakt: Email en Outlook
2026-01-21 21:13:15,140 - src.importer.importer - INFO -       ✓ Topic aangemaakt: Intranet en documenten
2026-01-21 21:13:15,142 - src.importer.importer - INFO - Import succesvol voltooid
2026-01-21 21:13:15,142 - root - INFO - Import finished
2026-01-21 21:13:15,144 - root - INFO - Homepage topic check: GET /topics/onboard-account -> status=200
2026-01-21 21:13:15,144 - root - INFO - ============================================================
2026-01-21 21:13:15,144 - root - INFO - TESTING PARTS (CONTENT) MANAGEMENT:
2026-01-21 21:13:15,144 - root - INFO - ============================================================
2026-01-21 21:13:15,146 - root - INFO - Checkout topic instr-1-1-2: status=200
2026-01-21 21:13:15,148 - root - INFO - Create part customPart for topic instr-1-1-2: status=200
2026-01-21 21:13:15,149 - root - INFO - Get parts for topic instr-1-1-2: status=200, count=2
2026-01-21 21:13:15,151 - root - INFO - Update part customPart for topic instr-1-1-2: status=200
2026-01-21 21:13:15,152 - root - INFO - Delete part customPart for topic instr-1-1-2: status=200
2026-01-21 21:13:15,153 - root - INFO - Verify part deletion: remaining parts=['contentPart'] (should not contain customPart)
2026-01-21 21:13:15,155 - root - INFO - Checkin topic instr-1-1-2: status=200
2026-01-21 21:13:15,155 - root - INFO - ============================================================
2026-01-21 21:13:15,155 - root - INFO - TESTING TOPIC UPDATE:
2026-01-21 21:13:15,155 - root - INFO - ============================================================
2026-01-21 21:13:15,157 - root - INFO - Checkout topic step-1-1 for update: status=200
2026-01-21 21:13:15,159 - root - INFO - Update topic step-1-1: status=200
2026-01-21 21:13:15,160 - root - INFO - Checkin topic step-1-1 after update: status=200
2026-01-21 21:13:15,162 - root - INFO - Verify update: topic title is now 'Account aanmaken (Updated)'
2026-01-21 21:13:15,162 - root - INFO - ============================================================
2026-01-21 21:13:15,162 - root - INFO - TESTING TOPIC DELETION:
2026-01-21 21:13:15,162 - root - INFO - ============================================================
2026-01-21 21:13:15,163 - root - INFO - Delete topic instr-2-2-2: status=200
2026-01-21 21:13:15,165 - root - INFO - Verify deletion: GET /topics/instr-2-2-2 -> status=404 (should be 404)
2026-01-21 21:13:15,165 - root - INFO - ============================================================
2026-01-21 21:13:15,165 - root - INFO - TESTING PROJECT DELETION:
2026-01-21 21:13:15,165 - root - INFO - ============================================================
2026-01-21 21:13:15,167 - root - INFO - Create test project test-project-delete: status=200
2026-01-21 21:13:15,168 - root - INFO - Verify project exists: GET /projects/test-project-delete -> status=200
2026-01-21 21:13:15,169 - root - INFO - Delete project test-project-delete: status=200
2026-01-21 21:13:15,171 - root - INFO - Verify deletion: GET /projects/test-project-delete -> status=404 (should be 404)
2026-01-21 21:13:15,171 - root - INFO - ============================================================
2026-01-21 21:13:15,171 - root - INFO - ALL TESTS PASSED!
2026-01-21 21:13:15,171 - root - INFO - ============================================================
2026-01-21 21:13:15,173 - root - INFO - ============================================================
2026-01-21 21:13:15,173 - root - INFO - IMPORTING PROCESS_SANERING.JSON WITH RELATIONS SUPPORT
2026-01-21 21:13:15,173 - root - INFO - ============================================================
2026-01-21 21:13:15,175 - root - INFO - Resetting mockserver state...
2026-01-21 21:13:15,177 - root - INFO - ✓ Mockserver reset complete
2026-01-21 21:13:15,178 - root - INFO - Loaded process_sanering.json from C:\Users\arieb\CascadeProjects\digitalecoach_client\tests\..\procesbeschrijving\process_sanering.json
2026-01-21 21:13:15,178 - root - INFO - Process: id=proces-sanering, title=Sanering, tasks=2
2026-01-21 21:13:15,178 - src.importer.mapper - INFO - Proces gemapt: proces-sanering - Sanering
2026-01-21 21:13:15,178 - src.importer.mapper - INFO - ✓ Proces gemapt naar 1 root topic met 2 kinderen
2026-01-21 21:13:15,178 - root - INFO - ✓ Mapped process to 1 root topic(s)
2026-01-21 21:13:15,178 - root - INFO - TOPIC TREE STRUCTURE:
[proces-sanering] Sanering (Digitale Coach Homepagina)
  ├─ [task-1] Selecteer Zaak (Task)
    ├─ [step-1-1] Stap 1 – Open postbak in WAB (Action)
      ├─ [instr-1-1-1] Ga naar de WAB-Post omgeving (Simple topic)
    ├─ [step-1-2] Stap 2 – Selecteer alleen kwijtscheldings / saneringsverzoeken (Action)
      ├─ [instr-1-2-1] Todo (Simple topic)
      ├─ [instr-1-2-2] Todo (Simple topic)
    ├─ [step-1-3] Stap 3 – In behandeling nemen poststuk saneringen (Action)
      ├─ [instr-1-3-1] Todo (Simple topic)
    ├─ [step-1-4] Stap 4 – Controleer taken op je naam (Action)
      ├─ [instr-1-4-1] Todo (Simple topic)
  ├─ [task-2] Quick scan verzoek (Task)
    ├─ [step-2-1] Stap 1– Check op vermogensbestanddelen (Action)
      ├─ [instr-2-1-1] Check op vermogensbestanddelen (Simple topic)
2026-01-21 21:13:15,179 - root - INFO - Created AskDelphiSession for base_url=http://127.0.0.1:8000
2026-01-21 21:13:15,180 - root - INFO - Starting import of topic tree...
2026-01-21 21:13:15,180 - src.importer.importer - INFO - Import gestart van 1 root topic(s)
2026-01-21 21:13:15,185 - src.importer.importer - INFO - ✓ Topic aangemaakt: Sanering
2026-01-21 21:13:15,188 - src.importer.importer - INFO -   ✓ Topic aangemaakt: Selecteer Zaak
2026-01-21 21:13:15,191 - src.importer.importer - INFO -     ✓ Topic aangemaakt: Stap 1 – Open postbak in WAB
2026-01-21 21:13:15,195 - src.importer.importer - INFO -       ✓ Topic aangemaakt: Ga naar de WAB-Post omgeving
2026-01-21 21:13:15,199 - src.importer.importer - INFO -     ✓ Topic aangemaakt: Stap 2 – Selecteer alleen kwijtscheldings / saneringsverzoeken
2026-01-21 21:13:15,202 - src.importer.importer - INFO -       ✓ Topic aangemaakt: Todo
2026-01-21 21:13:15,206 - src.importer.importer - INFO -       ✓ Topic aangemaakt: Todo
2026-01-21 21:13:15,211 - src.importer.importer - INFO -     ✓ Topic aangemaakt: Stap 3 – In behandeling nemen poststuk saneringen
2026-01-21 21:13:15,214 - src.importer.importer - INFO -       ✓ Topic aangemaakt: Todo
2026-01-21 21:13:15,219 - src.importer.importer - INFO -     ✓ Topic aangemaakt: Stap 4 – Controleer taken op je naam
2026-01-21 21:13:15,222 - src.importer.importer - INFO -       ✓ Topic aangemaakt: Todo
2026-01-21 21:13:15,227 - src.importer.importer - INFO -   ✓ Topic aangemaakt: Quick scan verzoek
2026-01-21 21:13:15,230 - src.importer.importer - INFO -     ✓ Topic aangemaakt: Stap 1– Check op vermogensbestanddelen
2026-01-21 21:13:15,234 - src.importer.importer - INFO -       ✓ Topic aangemaakt: Check op vermogensbestanddelen
2026-01-21 21:13:15,235 - src.importer.importer - INFO - Import succesvol voltooid
2026-01-21 21:13:15,235 - root - INFO - ✓ Import finished
2026-01-21 21:13:15,236 - root - INFO - ============================================================
2026-01-21 21:13:15,236 - root - INFO - VERIFYING IMPORT AND RELATIONS
2026-01-21 21:13:15,236 - root - INFO - ============================================================
2026-01-21 21:13:15,237 - root - INFO - ✓ Root topic retrieved: Sanering
2026-01-21 21:13:15,238 - root - INFO -   Relations: parent=None, children=2
2026-01-21 21:13:15,238 - root - INFO - ============================================================
2026-01-21 21:13:15,238 - root - INFO - EXPORTING CONTENT
2026-01-21 21:13:15,238 - root - INFO - ============================================================
2026-01-21 21:13:15,240 - root - INFO - ✓ Export retrieved
2026-01-21 21:13:15,241 - root - INFO -   Topics exported: 14
2026-01-21 21:13:15,241 - root - INFO -   Exported at: 2026-01-21T20:13:15.239555Z
2026-01-21 21:13:15,241 - root - INFO - ============================================================
2026-01-21 21:13:15,241 - root - INFO - VALIDATING RELATIONS IN EXPORT
2026-01-21 21:13:15,241 - root - INFO - ============================================================
2026-01-21 21:13:15,241 - root - INFO -   Topic Sanering: 2 children
2026-01-21 21:13:15,241 - root - INFO -   Topic Selecteer Zaak: 4 children
2026-01-21 21:13:15,241 - root - INFO -   Topic Stap 1 – Open postbak in WAB: 1 children
2026-01-21 21:13:15,241 - root - INFO -   Topic Stap 2 – Selecteer alleen kwijtscheldings / saneringsverzoeken: 2 children
2026-01-21 21:13:15,241 - root - INFO -   Topic Stap 3 – In behandeling nemen poststuk saneringen: 1 children
2026-01-21 21:13:15,241 - root - INFO -   Topic Stap 4 – Controleer taken op je naam: 1 children
2026-01-21 21:13:15,241 - root - INFO -   Topic Quick scan verzoek: 1 children
2026-01-21 21:13:15,241 - root - INFO -   Topic Stap 1– Check op vermogensbestanddelen: 1 children
2026-01-21 21:13:15,242 - root - INFO - ✓ Relations validation complete
2026-01-21 21:13:15,242 - root - INFO -   Topics with children: 8
2026-01-21 21:13:15,242 - root - INFO -   Total child relations: 13
2026-01-21 21:13:15,244 - root - INFO - ✓ Export saved to C:\Users\arieb\CascadeProjects\digitalecoach_client\log\test\export_sanering_20260121_211315.json
2026-01-21 21:13:15,245 - root - INFO - ============================================================
2026-01-21 21:13:15,245 - root - INFO - ALL TESTS PASSED!
2026-01-21 21:13:15,245 - root - INFO - ============================================================
